openapi: 3.0.3
info:
  title: Holidoit Business API
  version: "1.0.0"
  description: >
    API endpoints for the Holidoit integration.

    All endpoints are protected by HTTP Basic Authentication.
    Each request must include a valid username and password
    in the `Authorization` header.

    Example:
    ```
    Authorization: Basic base64(username:password)
    ```

servers:
  - url: https://staging.holydoit.com/api/v0/integrations/{integration}
    description: Test server
    variables:
      integration:
        default: freedome
        enum:
          - freedome
        description: The integration identifier.


paths:
  /partners:
    get:
      tags:
        - Integration
      summary: List partners with active experiences
      description: >
        Returns a list of partners that have configured for integration.  
        
        **Authentication required:** Basic Auth
      operationId: getPartners
      security:
        - BasicAuth: [ ]
      responses:
        '200':
          description: List of partners with active integration.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PartnerWithProducts'
              example:
                - id: "a3f20c3e-8f2e-4d33-bc12-88ff30dfbd9c"
                  products:
                    - id: "test-1"
                      internalName: "Test 1"
                    - id: "test-2"
                      internalName: "Test 2"
        '401':
          description: Authentication credentials were not provided or invalid.
        '403':
          description: Permission denied.

  /partners/{partnerId}/products:
    get:
      tags:
        - Integration
      summary: Get partner products with their options
      description: >        
        Returns all products of a partner,  
        including all options and their participant types.  
        
        **Authentication required:** Basic Auth
      operationId: getPartnerProducts
      security:
        - BasicAuth: [ ]
      parameters:
        - name: partnerId
          in: path
          required: true
          description: >
            Id of the partner.
          schema:
            type: string
            format: string
            example: "5d8de66c-d1ae-4a92-8279-f959f6a9afa8"
      responses:
        '200':
          description: List of all active products for the given partner.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductInfoResponse'
              example:
                - id: "test"
                  internalName: "test"
                  timeZone: "Europe/Rome"
                  options:
                    - id: 101
                      cutoffSeconds: 86400
                      cancellationCutoffSeconds: 43200
                      durationSeconds: 7200
                      bookingItems:
                        - id: 1
                          name: "Adult"
                        - id: 2
                          name: "Child"
                      minQuantity: 1
                      maxQuantity: 12
        '404':
          description: >
            No products found for the given partner ID.
        '401':
          description: Authentication credentials were not provided or invalid.
        '403':
          description: Permission denied.

  /products/{productId}:
    get:
      tags:
        - Integration
      summary: Get product info with its options
      description: >
        Returns detailed information for a single product,
        identified by its ID. Includes all options and their participant types.  
        
        **Authentication required:** Basic Auth
      operationId: getExperienceInfo
      security:
        - BasicAuth: [ ]
      parameters:
        - name: productId
          in: path
          required: true
          description: >
            Id of the experience.
          schema:
            type: string
            example: "test"
      responses:
        '200':
          description: Product details with all options.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductInfoResponse'
              example:
                id: "test"
                internalName: "Test"
                timeZone: "Europe/Rome"
                options:
                  - id: 101
                    cutoffSeconds: 86400
                    cancellationCutoffSeconds: 43200
                    durationSeconds: 7200
                    bookingItems:
                      - id: 1
                        name: "Adult"
                      - id: 2
                        name: "Child"
                    minQuantity: 1
                    maxQuantity: 12
        '404':
          description: Experience not found.
        '401':
          description: Authentication credentials were not provided or invalid.
        '403':
          description: Permission denied.

  /availabilities:
    get:
      tags:
        - Integration
      summary: Get option availabilities
      description: >
        Retrieve availability slots for a given option between two local datetimes.

        **Authentication required:** Basic Auth
      operationId: getAvailabilities
      security:
        - BasicAuth: [ ]
      parameters:
        - name: optionId
          in: query
          required: true
          description: The ID of the variant (option) to get availabilities for.
          schema:
            type: string
            example: "123"
        - name: localDateStart
          in: query
          required: true
          description: >
            The local start datetime in ISO 8601 format (e.g. `2024-11-17T09:00:00+00:00`).
          schema:
            type: string
            format: date-time
        - name: localDateEnd
          in: query
          required: true
          description: >
            The local end datetime in ISO 8601 format (e.g. `2024-11-20T18:00:00+00:00`).
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: List of availability slots for the given variant.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Availability'
        '400':
          description: Invalid parameters or validation failed.
        '401':
          description: Authentication credentials were not provided or invalid.
        '403':
          description: Permission denied.
        '404':
          description: Variant not found.

  /bookings:
    post:
      tags:
        - Integration
      summary: Reserve a booking
      description: >
        Create a new booking for a specific option.

        This endpoint validates availability, participant limits, and notice period,
        then reserves the slot by creating a booking in the Holidoit system.

        **Authentication required:** Basic Auth
      operationId: postReserveBooking
      security:
        - BasicAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReservationRequest'
            example:
              optionId: 123
              bookingReference: "FRD-ABC123"
              availability: "2025-06-15T10:00:00+02:00"
              bookingItems:
                - unitId: 1
                  quantity: 2
                - unitId: 2
                  quantity: 1
      responses:
        '200':
          description: Booking reserved successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReservationResponse'
              example:
                supplierReference: "HLD-987654"
                resellerReference: "FRD-ABC123"
                utcCreatedAt: "2025-06-15T08:00:00Z"
                utcExpiresAt: "2025-06-15T08:15:00Z"
                status: "ON_HOLD"
                availability:
                  - id: "2025-06-15T10:00:00+02:00"
                    localDateTimeStart: "2025-06-15T10:00:00+02:00"
                    localDateTimeEnd: "2025-06-15T12:00:00+02:00"
                    utcCutoffAt: "2025-06-15T08:00:00Z"
                    available: true
                    status: "AVAILABLE"
                    vacancies: 5
        '400':
          description: Invalid input data or validation error.
        '401':
          description: Authentication credentials were not provided or invalid.
        '403':
          description: Permission denied.
        '404':
          description: Variant not found.
    get:
      tags:
        - Integration
      summary: Search confirmed bookings
      description: >
        Search and filter confirmed bookings by date range,
        product, partner, option, or reseller references (AND).  
        
        If date range is not provided, the next 30 days are used by default.
        
        **Authentication required:** Basic Auth
      operationId: getBookings
      security:
        - BasicAuth: [ ]
      parameters:
        - name: resellerReferences
          in: query
          required: false
          description: >
            List of external booking references.
            Example: ?resellerReferences=ABC123
          schema:
            type: array
            items:
              type: string
            example: [ "ABC123", "XYZ999" ]

        - name: localDateTimeStart
          in: query
          required: false
          description: >
            Start date (YYYY-MM-DD). Used to compute the datetime window (included).
          schema:
            type: string
            format: date
            example: "2026-01-01"

        - name: localDateTimeEnd
          in: query
          required: false
          description: >
            End date (YYYY-MM-DD). Used to compute the datetime window (included).
          schema:
            type: string
            format: date
            example: "2026-03-01"

        - name: partnerId
          in: query
          required: false
          description: Partner UUID used for filtering.
          schema:
            type: string
            format: uuid
            example: "a3f20c3e-8f2e-4d33-bc12-88ff30dfbd9c"

        - name: productId
          in: query
          required: false
          description: Product Id used for filtering.
          schema:
            type: string
            example: "test"

        - name: optionId
          in: query
          required: false
          description: Variant ID used for filtering.
          schema:
            type: integer
            example: 101

      responses:
        '200':
          description: List of matching bookings.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BookingSearch'
              example:
                - status: "CONFIRMED"
                  resellerReference: "XXX-12345"
                  supplierReference: "YYY987654"
                  utcCreatedAt: "2025-06-10T08:00:00Z"
                  utcConfirmedAt: "2025-06-10T08:10:00Z"
                  optionId: 101
                  productId: "test-1"
                  localDateTimeStart: "2025-06-20T10:00:00+02:00"
                  localDateTimeEnd: "2025-06-20T12:00:00+02:00"
                  contact:
                    firstName: "John"
                    lastName: "Doe"
                    emailAddress: "john@example.com"
                    phoneNumber: "+39333111222"
                  notes: "Customer requested window seating"
                  unitItems:
                    - unitId: 1
                      quantity: 2
                    - unitId: 2
                      quantity: 1
        '401':
          description: Authentication credentials were not provided or invalid.
        '403':
          description: Permission denied.

  /bookings/{resellerReference}/reserve/cancel:
    post:
      tags:
        - Integration
      summary: Cancel a pending reservation
      description: >
        Cancels a *pending* reservation,
        identified by its `resellerReference`.

        If the reservation exists, it is deleted.  
        
        **Authentication required:** Basic Auth
      operationId: postCancelReservation
      security:
        - BasicAuth: [ ]
      parameters:
        - name: resellerReference
          in: path
          required: true
          description: External reference of the reservation to cancel.
          schema:
            type: string
            example: "FRD-RES-12345"
      responses:
        '200':
          description: Reservation cancelled successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CancelReservationResponse'
              example:
                resellerReference: "FRD-RES-12345"
                supplierReference: "HLD-555555"
                utcCreatedAt: "2025-06-20T10:00:00Z"
                utcCanceledAt: "2025-06-20T10:05:00Z"
                status: "CANCELLED"
        '404':
          description: Reservation not found.
        '401':
          description: Authentication credentials were not provided or invalid.
        '403':
          description: Permission denied.

  /bookings/{resellerReference}/confirm:
    post:
      tags:
        - Integration
      summary: Confirm a booking
      description: >
        Confirms a previously reserved booking identified by its `resellerReference`.

        This endpoint finalizes a booking by setting its status to **CONFIRMED**,
        validating the customer's contact information, and triggering confirmation
        workflows such as partner emails.

        **Authentication required:** Basic Auth
      operationId: postConfirmBooking
      security:
        - BasicAuth: [ ]
      parameters:
        - name: resellerReference
          in: path
          required: true
          description: >
            The external booking reference provided during reservation
            (e.g., the `bookingReference` used in the `/bookings` endpoint).
          schema:
            type: string
            example: "FRD-ABC123"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfirmBookingRequest'
            example:
              contact:
                firstName: "John"
                lastName: "Doe"
                emailAddress: "john.doe@example.com"
                phoneNumber: "+39333111222"
              amount: 150.00
              notes: "Customer requested window seats"
      responses:
        '200':
          description: Booking confirmed successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfirmBookingResponse'
              example:
                resellerReference: "FRD-ABC123"
                supplierReference: "HLD-987654"
                utcCreated_at: "2025-06-15T08:00:00Z"
                utcConfirmed_at: "2025-06-15T08:05:00Z"
                status: "CONFIRMED"
        '400':
          description: Invalid input data or validation error.
        '401':
          description: Authentication credentials were not provided or invalid.
        '403':
          description: Permission denied.
        '404':
          description: Booking not found.

  /bookings/{resellerReference}/cancel:
    post:
      tags:
        - Integration
      summary: Cancel a booking
      description: >
        Cancels a previously confirmed booking identified by its `resellerReference`.

        This endpoint marks the booking as **CANCELLED**.
        **Authentication required:** Basic Auth
      operationId: postCancelBooking
      security:
        - BasicAuth: [ ]
      parameters:
        - name: resellerReference
          in: path
          required: true
          description: >
            The external booking reference provided during reservation
            (e.g., the `bookingReference` used in the `/bookings` endpoint).
          schema:
            type: string
            example: "FRD-ABC123"
      responses:
        '200':
          description: Booking cancelled successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CancelBookingResponse'
              example:
                resellerReference: "FRD-ABC123"
                supplierReference: "HLD-987654"
                utcCanceledAt: "2025-06-15T09:00:00Z"
                utcCreatedAt: "2025-06-15T08:00:00Z"
                utcConfirmedAt: "2025-06-15T08:05:00Z"
                status: "CANCELLED"
        '400':
          description: Invalid input or the booking cannot be cancelled.
        '401':
          description: Authentication credentials were not provided or invalid.
        '403':
          description: Permission denied.
        '404':
          description: Booking not found.

  /bookings/{resellerReference}:
    patch:
      tags:
        - Integration
      summary: Amend an existing booking
      description: >
        Partially update a booking identified by its `resellerReference`.  
        This endpoint allows modifying:
        - The scheduled availability (date/time)
        - Participant quantities
        - Contact details
        - Notes
        - Booking amount

        Fields that are not provided in the request will remain unchanged.
        **Authentication required:** Basic Auth  

      operationId: patchBookingAmendment
      security:
        - BasicAuth: [ ]
      parameters:
        - name: resellerReference
          in: path
          required: true
          description: >
            The external booking reference provided during reservation
            (e.g., the `bookingReference` used in the `/bookings` endpoint).
          schema:
            type: string
            example: "FRD-ABC123"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookingAmendmentRequest'
            example:
              availability: "2025-06-16T10:00:00+02:00"
              notes: "Customer requested earlier departure time"
              bookingItems:
                - unitId: 1
                  quantity: 3
              contact:
                firstName: "Jane"
                lastName: "Doe"
                phoneNumber: "+39333999888"
              amount: 200.00
      responses:
        '200':
          description: Booking amended successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingAmendmentResponse'
              example:
                resellerReference: "FRD-ABC123"
                supplierReference: "HLD-987654"
                utcUpdatedAt: "2025-06-16T08:15:00Z"
                status: "CONFIRMED"
        '400':
          description: Invalid amendment data or validation error.
        '401':
          description: Authentication credentials were not provided or invalid.
        '403':
          description: Permission denied.
        '404':
          description: Booking not found.

components:
  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic
      description: >
        HTTP Basic authentication using username and password.

  schemas:
    PartnerWithProducts:
      type: object
      required:
        - id
        - products
      properties:
        id:
          type: string
          example: "a3f20c3e-8f2e-4d33-bc12-88ff30dfbd9c"
          description: UUID of the partner.
        products:
          type: array
          items:
            $ref: '#/components/schemas/PartnerProduct'

    PartnerProduct:
      type: object
      required:
        - id
        - internalName
      properties:
        id:
          type: string
          example: "test"
          description: >
            Experience id.
        internalName:
          type: string
          example: "Test"

    OptionInfo:
      type: object
      required:
        - id
        - cutoffSeconds
        - cancellationCutoffSeconds
        - durationSeconds
        - bookingItems
      properties:
        id:
          type: integer
          example: 123
          description: The ID of the variant.
        cutoffSeconds:
          type: integer
          example: 86400
          description: Booking cutoff time in seconds.
        cancellationCutoffSeconds:
          type: integer
          example: 43200
          description: Cancellation cutoff time in seconds.
        durationSeconds:
          type: integer
          example: 7200
          description: Duration of the experience in seconds.
        bookingItems:
          type: array
          description: Available participant options.
          items:
            $ref: '#/components/schemas/OptionBookingItem'
        minQuantity:
          type: integer
          nullable: true
          example: 1
          description: Minimum number of participants.
        maxQuantity:
          type: integer
          nullable: true
          example: 10
          description: Maximum number of participants.

    OptionBookingItem:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: integer
          example: 1
          description: The participant type ID.
        name:
          type: string
          example: Adult
          description: The participant type name.

    Availability:
      type: object
      required:
        - id
        - localDateTimeStart
        - localDateTimeEnd
        - available
        - status
        - vacancies
      properties:
        id:
          type: string
          example: "2025-06-12T10:00:00+01:00"
          description: A unique identifier for this availability (usually an ISO datetime string).
        localDateTimeStart:
          type: string
          format: date-time
          example: "2025-06-12T10:00:00+01:00"
          description: Local start time for the availability.
        localDateTimeEnd:
          type: string
          format: date-time
          example: "2025-06-12T12:00:00+01:00"
          description: Local end time for the availability.
        utcCutoffAt:
          type: string
          format: date-time
          nullable: true
          example: "2025-06-12T09:00:00Z"
          description: UTC cutoff time for booking this slot.
        available:
          type: boolean
          example: true
          description: Whether the slot is available for booking.
        status:
          type: string
          example: "AVAILABLE"
          description: The availability status.
        vacancies:
          type: integer
          example: 5
          description: Number of available places.

    ReservationRequest:
      type: object
      required:
        - optionId
        - bookingReference
        - availability
        - bookingItems
      properties:
        optionId:
          type: integer
          example: 123
        bookingReference:
          type: string
          example: "FRD-ABC123"
        availability:
          type: string
          format: date-time
          example: "2025-06-15T10:00:00+02:00"
        bookingItems:
          type: array
          items:
            $ref: '#/components/schemas/ReservationBookingItem'

    ReservationBookingItem:
      type: object
      required:
        - unitId
        - quantity
      properties:
        unitId:
          type: integer
          example: 1
        quantity:
          type: integer
          example: 2

    ReservationResponse:
      type: object
      required:
        - supplierReference
        - utcCreatedAt
        - utcExpiresAt
        - status
        - availability
      properties:
        supplierReference:
          type: string
          example: "HLD-987654"
        resellerReference:
          type: string
          nullable: true
          example: "FRD-ABC123"
        utcCreatedAt:
          type: string
          format: date-time
          example: "2025-06-15T08:00:00Z"
        utcExpiresAt:
          type: string
          format: date-time
          example: "2025-06-15T08:15:00Z"
        status:
          type: string
          example: "ON_HOLD"
        availability:
          type: array
          items:
            $ref: '#/components/schemas/Availability'

    ConfirmBookingRequest:
      type: object
      required:
        - contact
        - amount
      properties:
        contact:
          $ref: '#/components/schemas/Contact'
        amount:
          type: number
          format: decimal
          example: 150.00
        notes:
          type: string
          nullable: true
          example: "Customer requested window seats"

    Contact:
      type: object
      required:
        - firstName
        - lastName
        - emailAddress
      properties:
        firstName:
          type: string
          example: "John"
        lastName:
          type: string
          example: "Doe"
        emailAddress:
          type: string
          format: email
          example: "john.doe@example.com"
        phoneNumber:
          type: string
          nullable: true
          example: "+39333111222"

    ConfirmBookingResponse:
      type: object
      required:
        - resellerReference
        - supplierReference
        - utcCreated_at
        - utcConfirmed_at
        - status
      properties:
        resellerReference:
          type: string
          example: "FRD-ABC123"
        supplierReference:
          type: string
          example: "HLD-987654"
        utcCreated_at:
          type: string
          format: date-time
          example: "2025-06-15T08:00:00Z"
        utcConfirmed_at:
          type: string
          format: date-time
          example: "2025-06-15T08:05:00Z"
        status:
          type: string
          example: "CONFIRMED"

    CancelBookingResponse:
      type: object
      required:
        - resellerReference
        - supplierReference
        - utcCanceledAt
        - utcCreatedAt
        - utcConfirmedAt
        - status
      properties:
        resellerReference:
          type: string
          example: "FRD-ABC123"
        supplierReference:
          type: string
          example: "HLD-987654"
        utcCanceledAt:
          type: string
          format: date-time
          example: "2025-06-15T09:00:00Z"
        utcCreatedAt:
          type: string
          format: date-time
          example: "2025-06-15T08:00:00Z"
        utcConfirmedAt:
          type: string
          format: date-time
          example: "2025-06-15T08:05:00Z"
        status:
          type: string
          example: "CANCELLED"

    BookingAmendmentRequest:
      type: object
      properties:
        availability:
          type: string
          format: date-time
          nullable: true
          example: "2025-06-16T10:00:00+02:00"
        notes:
          type: string
          nullable: true
          example: "Customer requested earlier departure time"
        bookingItems:
          type: array
          items:
            $ref: '#/components/schemas/ReservationBookingItem'
        contact:
          $ref: '#/components/schemas/Contact'
        amount:
          type: number
          format: decimal
          example: 200.00
      description: >
        Partial update request for an existing booking.  
        All fields are optional â€” only the provided ones will be updated.

    BookingAmendmentResponse:
      type: object
      required:
        - resellerReference
        - supplierReference
        - utcUpdatedAt
        - status
      properties:
        resellerReference:
          type: string
          example: "FRD-ABC123"
        supplierReference:
          type: string
          example: "HLD-987654"
        utcUpdatedAt:
          type: string
          format: date-time
          example: "2025-06-16T08:15:00Z"
        status:
          type: string
          example: "CONFIRMED"

    ProductInfoResponse:
      type: object
      required:
        - id
        - internalName
        - timeZone
        - options
      properties:
        id:
          type: string
          example: "test"
          description: Experience slug (string identifier)
        internalName:
          type: string
          example: "Test"
        timeZone:
          type: string
          example: "Europe/Rome"
        options:
          type: array
          items:
            $ref: '#/components/schemas/OptionInfo'

    BookingSearch:
      type: object
      required:
        - status
        - resellerReference
        - supplierReference
        - utcCreatedAt
        - optionId
        - productId
        - localDateTimeStart
        - localDateTimeEnd
        - contact
        - unitItems
      properties:
        status:
          type: string
          example: "CONFIRMED"

        resellerReference:
          type: string
          description: reseller reference
          example: "FRD-12345"

        supplierReference:
          type: string
          description: Internal Holidoit booking code
          example: "HLD-987654"

        utcCreatedAt:
          type: string
          format: date-time
          example: "2025-06-10T08:00:00Z"

        utcConfirmedAt:
          type: string
          nullable: true
          format: date-time
          example: "2025-06-10T08:10:00Z"

        optionId:
          type: integer
          description: ExperienceVariant ID
          example: 101

        productId:
          type: string
          description: Experience slug
          example: "boat-tour-amalfi"

        localDateTimeStart:
          type: string
          format: date-time
          example: "2025-06-20T10:00:00+02:00"

        localDateTimeEnd:
          type: string
          format: date-time
          example: "2025-06-20T12:00:00+02:00"

        contact:
          $ref: '#/components/schemas/BookingContact'

        notes:
          type: string
          nullable: true
          example: "Customer requested window seating"

        unitItems:
          type: array
          description: Grouped participant allocations
          items:
            type: object
            properties:
              unitId:
                type: integer
                example: 1
              quantity:
                type: integer
                example: 2

    BookingContact:
      type: object
      required:
        - firstName
        - lastName
        - emailAddress
        - phoneNumber
      properties:
        firstName:
          type: string
          example: "John"
        lastName:
          type: string
          example: "Doe"
        emailAddress:
          type: string
          format: email
          example: "john@example.com"
        phoneNumber:
          type: string
          example: "+39333111222"

    CancelReservationResponse:
      type: object
      required:
        - resellerReference
        - supplierReference
        - utcCanceledAt
        - utcCreatedAt
        - status
      properties:
        resellerReference:
          type: string
          example: "FRD-RES-12345"
        supplierReference:
          type: string
          example: "HLD-555555"
        utcCanceledAt:
          type: string
          format: date-time
          example: "2025-06-20T10:05:00Z"
        utcCreatedAt:
          type: string
          format: date-time
          example: "2025-06-20T10:00:00Z"
        status:
          type: string
          example: "CANCELLED"
